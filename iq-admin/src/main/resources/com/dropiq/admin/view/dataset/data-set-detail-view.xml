<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<view xmlns="http://jmix.io/schema/flowui/view"
      title="msg://dataSetDetailView.title"
      focusComponent="form">
    <data>
        <instance id="dataSetDc"
                  class="com.dropiq.admin.entity.DataSet">
            <fetchPlan extends="_base">
                <property name="products" fetchPlan="_base"/>
            </fetchPlan>
            <loader id="dataSetDl"/>
        </instance>

        <collection id="treeItemsDc"
                    class="com.dropiq.admin.entity.ProductTreeItem">
            <loader id="treeItemsDl" readOnly="true"/>
        </collection>
    </data>
    <facets>
        <dataLoadCoordinator auto="true"/>
    </facets>
    <actions>
        <action id="saveAction" type="detail_saveClose"/>
        <action id="closeAction" type="detail_close"/>
    </actions>

    <layout>
        <vbox width="100%" height="100%" spacing="true">
            <tabSheet id="tabSheet" width="100%" height="100%">

                <!-- Dataset Info Tab -->
                <tab id="infoTab" label="Dataset Info">
                    <vbox spacing="true" padding="true">
                        <formLayout id="form" dataContainer="dataSetDc">
                            <responsiveSteps>
                                <responsiveStep minWidth="0" columns="1"/>
                                <responsiveStep minWidth="40em" columns="2"/>
                            </responsiveSteps>

                            <textField id="nameField" property="name" colspan="2"/>
                            <textArea id="descriptionField" property="description" colspan="2" height="100px"/>

                            <select id="statusField" property="status"/>
                            <textField id="createdByField" property="createdBy" readOnly="true"/>

                            <dateTimePicker id="lastSyncField" property="lastSync" readOnly="true"/>
                            <checkbox id="autoSyncField" property="autoSync"/>

                            <textField id="totalProductsField" property="totalProducts" readOnly="true"/>
                            <textField id="activeProductsField" property="activeProducts" readOnly="true"/>

                            <textField id="defaultMarkupField" property="defaultMarkup"/>
                            <textField id="minProfitMarginField" property="minProfitMargin"/>

                            <checkbox id="aiOptimizationEnabledField" property="aiOptimizationEnabled"/>
                            <checkbox id="seoOptimizationEnabledField" property="seoOptimizationEnabled"/>
                        </formLayout>

                        <hbox spacing="true" padding="true">
                            <button id="syncDatasetButton"
                                    text="Synchronize Dataset"
                                    icon="REFRESH"
                                    themeNames="primary"/>
                        </hbox>
                    </vbox>
                </tab>

                <!-- Products Tab -->
                <tab id="productsTab" label="Products">
                    <vbox width="100%" height="100%" spacing="true" padding="true">

                        <!-- Filter Toggle and Tree Controls -->
                        <hbox spacing="true" alignItems="CENTER">
                            <button id="toggleFiltersButton"
                                    text="Show Filters"
                                    icon="ANGLE_DOWN"/>
                            <separator/>
                            <button id="expandAllButton"
                                    text="Expand All"
                                    icon="PLUS"
                                    themeNames="tertiary"/>
                            <button id="collapseAllButton"
                                    text="Collapse All"
                                    icon="MINUS"
                                    themeNames="tertiary"/>
                        </hbox>

                        <!-- Advanced Filters Container -->
                        <div id="filtersContainer" visible="false" className="filters-container">
                            <vbox spacing="true" padding="true">

                                <!-- Basic Text Filters -->
                                <hbox spacing="true" alignItems="END">
                                    <textField id="nameFilter"
                                               label="Product Name"
                                               placeholder="Search by name..."
                                               width="200px"/>
                                    <textField id="categoryFilter"
                                               label="Category"
                                               placeholder="Search by category..."
                                               width="200px"/>
                                    <textField id="descriptionFilter"
                                               label="Description"
                                               placeholder="Search in description..."
                                               width="200px"/>
                                </hbox>

                                <!-- Source and Status Filters -->
                                <hbox spacing="true" alignItems="END">
                                    <select id="sourceTypeFilter"
                                            label="Source Type"
                                            width="200px"/>
                                    <select id="statusFilter"
                                            label="Status"
                                            width="200px"/>
                                </hbox>

                                <!-- Price Filters -->
                                <hbox spacing="true" alignItems="END">
                                    <textField id="